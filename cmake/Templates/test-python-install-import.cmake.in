CMAKE_POLICY(SET CMP0010 NEW)
SET(DEFAULT_PYTHONPATH "$ENV{PYTHONPATH}")
SET(INSTALL_PYTHONPATH "@INSTALL_PYTHONDIR@")
IF(NOT IS_ABSOLUTE "${INSTALL_PYTHONPATH}")
    SET(INSTALL_PYTHONPATH "@CMAKE_INSTALL_PREFIX@/${INSTALL_PYTHONPATH}")
ENDIF()
GET_FILENAME_COMPONENT(INSTALL_PYTHONPATH "${INSTALL_PYTHONPATH}" DIRECTORY)

SET(ENV{TIMEMORY_BANNER} "OFF")
SET(ENV{PYTHONPATH} "${INSTALL_PYTHONPATH}:${DEFAULT_PYTHONPATH}")
MESSAGE(STATUS "PYTHONPATH: $ENV{PYTHONPATH}")

EXECUTE_PROCESS(
    COMMAND @PYTHON_EXECUTABLE@ -c "import timemory; print('{}'.format(timemory.__file__))"
    WORKING_DIRECTORY @PROJECT_BINARY_DIR@/tests
    OUTPUT_VARIABLE OUT_MSG
    ERROR_VARIABLE ERR_MSG
    RESULT_VARIABLE ERR_CODE
    OUTPUT_STRIP_TRAILING_WHITESPACE
    ERROR_STRIP_TRAILING_WHITESPACE)

IF(ERR_CODE)
    MESSAGE(FATAL_ERROR "Error! Exit code: ${ERR_CODE}. ${ERR_MSG}")
ELSE()
    MESSAGE(STATUS "Success! Exit code: ${ERR_CODE}. ${OUT_MSG}")
ENDIF()
